---
title: "R Proyecto Final"
output: html_notebook
---
```{r}
#Modificar variable para especificar directorio del Proyecto Final
#local.path <- "/Users/akcasill/Downloads"

user.path <- "/Users/jos/Downloads/"

local.path <- paste(user.path ,"mcc-ad/data",sep = "")
local.path.imgs <- paste(user.path ,"mcc-ad/imgs",sep = "")
```


```{r}
#Dependencies
#install.packages("png")
library(png)
```

#ASISTENCIAS TOTALES
```{r}
setwd(local.path)
# son 9 semestres de 6 materias cada uno. 
# 1.- Asistencias Totales
load("AsistenciasTotales.R")
class(asistencias.totales)
length(asistencias.totales)
class(asistencias.totales[[1]])
dim(asistencias.totales[[1]])
class(asistencias.totales[1])

asistencias.totales[[1]][1:10,1:10]
```
```{r}
#Asistencias
#===================
#Definición Valores
#===================
# 2 El alumno tiene asistnecia completa.
# 1 El alumno tiene retardo.
# 0 El alumno tiene falta.

#Sólo tomar las primeras 12 materias (Columnas)
for(i in 1:length(asistencias.totales)){
  asistencias.totales[[i]] <- asistencias.totales[[i]][,1:12]
}
asistencias.totales[[4]]
```
Tamaño de Lista de Asistencia de Alumnos:
```{r}
length(asistencias.totales)
```
Lista de total Asistencias por Alumno
```{r}
#
#for(i in 1:length(asistencias.totales)){
#  asistencias.totales[[i]] <- asistencias.totales[[i]][,1:12]
#}
asistencias.alumnos <- matrix(1:12000, nrow=1000, ncol=12)

for(i in 1:length(asistencias.totales)){
  for(j in 1:12){
    asistencias.alumnos[i,j] <- sum(asistencias.totales[[i]][,j])/32    
  }
}

asistencias.alumnos[1,]
asistencias.df <- as.data.frame(asistencias.alumnos)

#Asistencia Materias Ejemplo: AM1 = Asistencia Materia 1
colnames(asistencias.df) <- c('AM1','AM2','AM3','AM4','AM5','AM6','AM7','AM8','AM9','AM10','AM11','AM12')
#DATA FRAME DE ASISTENCIAS ALUMNOS
#=================================
#Suma de asistencias por Materia
#=================================
asistencias.df
```
#PERFIL ALUMNOS
```{r}
setwd(local.path)
print("Summary")
load("perfilAlumnos.R")
#head(perfil.alumnos,1)
str(perfil.alumnos)
summary(perfil.alumnos)

#===================
#Definición Valores
#===================
# Genero: 2 Hombre, 1 Mujer.
# admision.letras: Calificación Examen Admisión Español
# admision.numeros: Calificación Examen Admisión Matemáticas
# promedio.preparatoria: Calificación Promedio Preparatoria   
# edad.ingreso: Edad, variable numérica             
# evalucion.socioeconomica: 1 más privilegiado, 4 menos privilagiado
# nota.conducta: Calificación subjetiva. 

```

```{r}
perfil.alumnos$genero <- factor(perfil.alumnos$genero)
perfil.alumnos$evalucion.socioeconomica <-
  factor(perfil.alumnos$evalucion.socioeconomica)

perfil.alumnos$edad.ingreso <- 
  factor(perfil.alumnos$edad.ingreso)
```


#DATAFRAME CALIFICACIONES ALUMNOS
```{r}
setwd(local.path)
print("Summary")
# 3 1000 matrices de 2 x 54, calificación entre 1 y 20
load("ResultadosExamenes.R")
#resultados.examenes.totales

examenes.alumnos <- matrix(1:12000, nrow=1000, ncol=12)

for(i in 1:length(resultados.examenes.totales)){
  for(j in 1:12){
    examenes.alumnos[i,j] <- sum(resultados.examenes.totales[[i]][,j])/2    
  }
}

examenes.alumnos[1,]
cal.alumnos.df <- as.data.frame(examenes.alumnos)
#Calificaciones Materias Ejemplo: CM2 = Calificiación Promedio Materia 2
colnames(cal.alumnos.df) <- c('CM1','CM2','CM3','CM4','CM5','CM6','CM7','CM8','CM9','CM10','CM11','CM12')
#===================
#Definición Valores
#===================
# CM1: Calificación Materia 1 valor Máximo 20
cal.alumnos.df
```

#TRABAJOS POR CLASE
```{r}
setwd(local.path)
print("Summary")
# 4 1000 matrices de 4 x 54, son 4 trabajos por clase, entre 1 y 20
load("ResultadoTrabajos.R")
resultados.trabajos.totales[[2]][,1]

tareas.alumnos <- matrix(1:12000, nrow=1000, ncol=12)

for(i in 1:length(resultados.trabajos.totales)){
  for(j in 1:12){
    tareas.alumnos[i,j] <- sum(resultados.trabajos.totales[[i]][,j])/4    
  }
}

#tareas.alumnos[1,]
tareas.alumnos.df <- as.data.frame(tareas.alumnos)
#Tareas Materias Ejemplo: TM2 = Tareas Promedio Materia 2
colnames(tareas.alumnos.df) <- c('TM1','TM2','TM3','TM4','TM5','TM6','TM7','TM8','TM9','TM10','TM11','TM12')
#===================
#Definición Valores
#===================
# TM1: Calificación Tarea Materia 1 valor Máximo 20
tareas.alumnos.df
```

#VISITAS BIBLIOTECA
```{r}
# 5 Redondear. Uso físico y virtual. vector. 1000 Matrices, número de veces que asistio a la biblioteca por materia
setwd(local.path)
load("UsoBiblioteca.R")
length(uso.biblioteca.totales)
mi.val <- uso.biblioteca.totales[[1]][1,1]
mi.val
mi.val <- as.data.frame(mi.val)
mi.val

visitas.biblio.alumnos <- matrix(1:12000, nrow=1000, ncol=12)

for(i in 1:1000){
  for(j in 1:12){
    visitas.biblio.alumnos[i,j] <- uso.biblioteca.totales[[i]][1,j]
  }
}

visitas.biblio.alumnos.df <- as.data.frame(visitas.biblio.alumnos)
#Visitas Biblioteca  Ejemplo: VBM2 = Visitas Biblioteca  Materia 2
colnames(visitas.biblio.alumnos.df) <- c('VBM1','VBM2','VBM3','VBM4','VBM5','VBM6','VBM7','VBM8','VBM9','VBM10','VBM11','VBM12')
#===================
#Definición Valores
#===================
# VBM1: Visitas Biblioteca Materia 1
visitas.biblio.alumnos.df


```

#USO DE PLATAFORMAS DIGITALES
```{r}
# 6 Redondear, vector. Uso de Canvas o de Plataforma digital.
setwd(local.path)
load("UsoPlataforma.R")
#uso.plataforma.totales
uso.plataforma.totales[[1]][,1:12]
plataformas.alumnos <- matrix(1:12000, nrow=1000, ncol=12)

for(i in 1:1000){
  for(j in 1:12){
    plataformas.alumnos[i,j] <- uso.plataforma.totales[[i]][1,j]
  }
}

#tareas.alumnos[1,]
plataformas.alumnos.df <- as.data.frame(plataformas.alumnos)
#Tareas Materias Ejemplo: TM2 = Tareas Promedio Materia 2
colnames(plataformas.alumnos.df) <- c('PDM1','PDM2','PDM3','PDM4','PDM5','PDM6','PDM7','PDM8','PDM9','PDM10','PDM11','PDM12')
#===================
#Definición Valores
#===================
# PDM1: Plataformas Digitales Materia 1 valor Máximo 20
plataformas.alumnos.df

```

#APARTADO DE LIBROS POR MATERIA
```{r}
# 7
setwd(local.path)
load("ApartadoDeLibros.R") #1000 matrices, cantidad de libros que el alumno reservó por materia.
separacion.libros.totales[[1]][,1:12]

reserva.libros.alumnos <- matrix(1:12000, nrow=1000, ncol=12)

for(i in 1:1000){
  for(j in 1:12){
    reserva.libros.alumnos[i,j] <- separacion.libros.totales[[i]][1,j]
  }
}

reserva.libros.alumnos.df <- as.data.frame(reserva.libros.alumnos)
#Reserva de Libris Ejemplo: RLM2 = Reserva de Libros Por Materia 2
colnames(reserva.libros.alumnos.df) <- c('RLM1','RLM2','RLM3','RLM4','RLM5','RLM6','RLM7','RLM8','RLM9','RLM10','RLM11','RLM12')
#===================
#Definición Valores
#===================
# RLM1: Reserva de Libros pro Materia 1
reserva.libros.alumnos.df

```

#DISTRIBUCIÓN DE BECAS ALUMNOS
```{r}
# 8 vector binario, 1 tiene beca, 0 no tiene Beca
setwd(local.path)
load("Becas.R")
distribucion.becas[[1]]
sum(distribucion.becas)

becas.alumnos <- matrix(1:1000, nrow=1000, ncol=1)

for(i in 1:1000){
    becas.alumnos[i] <- distribucion.becas[i]
}

becas.alumnos.df <- as.data.frame(becas.alumnos)
colnames(becas.alumnos.df) <- c('BECA')
#===================
#Definición Valores
#===================
# BECA: Tiene Beca 1
becas.alumnos.df
#Necesita ser un factor por que solo tiene dos valores 0 o 1 
becas.alumnos.df$BECA <- as.factor(becas.alumnos.df$BECA)
becas.alumnos.df
```

#HISTORIAL DE PAGOS ALUMNOS
```{r}
# 9  2 en tiempo, 1 retraso, 0, Son 9 semestres pero hay que user sólo 2 primeras columnas, 4 pagos.
setwd(local.path)
load("HistorialPagos.R")
length(registro.pagos)
registro.pagos[[500]]


pagos.alumnos <- matrix(1:2000, nrow=1000, ncol=2)

for(i in 1:1000){
  for(j in 1:2){
    pagos.alumnos[i,j] <- sum(registro.pagos[[i]][,j])/4    
  }
}

#tareas.alumnos[1,]
pagos.alumnos.df <- as.data.frame(pagos.alumnos)
#Pago Semestre: PSEM2 = Pago Semestre 2
colnames(pagos.alumnos.df) <- c('PSEM1','PSEM2')
#===================
#Definición Valores
#===================
# PSEM1: Suma de pagos semestre 1, 2 valor máximo.
pagos.alumnos.df

```



```{r}
datos.alumnos.df <- cbind.data.frame(perfil.alumnos,
                                     becas.alumnos.df,
                              asistencias.df,
                              cal.alumnos.df,
                              tareas.alumnos.df,
                              visitas.biblio.alumnos.df,
                              plataformas.alumnos.df,
                              reserva.libros.alumnos.df,
                              pagos.alumnos.df)
datos.alumnos.df

```

```{r}
str(datos.alumnos.df)
```

```{r}
summary(datos.alumnos.df)
datos.integrados <- datos.alumnos.df
```

```{r}
setwd(local.path)
save(datos.integrados, file="datos.integrados.R")
getwd()
load("datos.integrados.R")
datos.integrados
head(datos.integrados)

```

#Separar 100 alumnos que no entraran en Kmeans
```{r}
set.seed(1234)

ind <- sample(x=c(0,1),size=nrow(datos.integrados),
              replace=TRUE,prob = c(0.9,0.1))
ind

alumnos.nuevos <- datos.integrados[ind==1,]
alumnos.actuales <- datos.integrados[ind==0,]

alumnos.nuevos
alumnos.actuales
```


```{r}
summary(alumnos.nuevos)
```

```{r}
summary(alumnos.actuales)
```


```{r}
set.seed(1234)

ind <- sample(x=c(0,1),size=nrow(alumnos.actuales),
              replace=TRUE,prob = c(0.7,0.3))
ind

alumnos.training <- alumnos.actuales[ind==0,]
alumnos.test <- alumnos.actuales[ind==1,]

str(alumnos.training)
```

```{r}
set.seed(2020)
wss.alumnos <-vector()
wss.alumnos
centroides.alumnos <- 25
for ( i in 1:centroides.alumnos ) wss.alumnos[i] <- sum(kmeans(alumnos.training,centers = i)$withinss)

#plot
plot(1:centroides.alumnos  , wss.alumnos , type="b", xlab="Numer de clusters", ylab="Error standard")
```



### Analísis de hombro, brazo, codo para seleccionar el centroide
```{r}
imgPath.codo <- paste(local.path.imgs,"/Kmeans-codo-alumnos.png",sep = "")


img.codo.alumnos <- readPNG(imgPath.codo)
plot.new()
rasterImage(img.codo.alumnos,0,0,1,1)
```

```{r}
set.seed(2020)
wss.alumnos <-vector()
wss.alumnos
centroides.alumnos <- 10
for ( i in 1:centroides.alumnos ) wss.alumnos[i] <- sum(kmeans(alumnos.training,centers = i)$withinss)

#plot
plot(1:centroides.alumnos  , wss.alumnos , type="b", xlab="Numer de clusters", ylab="Error standard")
```

```{r}
imgPath.codo.seleccionado <- paste(local.path.imgs,"/Kmeans-codo-alumnos-seleccionado.png",sep = "")


img.codo.sel.alumnos <- readPNG(imgPath.codo.seleccionado)
plot.new()
rasterImage(img.codo.sel.alumnos,0,0,1,1)

```


```{r}

centroides.alumnos <- 4
clustering.kmeans <- kmeans(x=alumnos.training, centers = centroides.alumnos)
clustering.kmeans$withinss
```

```{r}
alumnos.training$genero <- as.numeric(alumnos.training$genero)
alumnos.training$edad.ingreso <- as.numeric(alumnos.training$edad.ingreso)
alumnos.training$evalucion.socioeconomica <- as.numeric(alumnos.training$evalucion.socioeconomica)
alumnos.training$BECA <- as.numeric(alumnos.training$BECA)
sum(is.na(alumnos.training))
#str(alumnos.training)
```

```{r}
datos.alumnos.df$genero <- as.numeric(datos.alumnos.df$genero)
datos.alumnos.df$edad.ingreso <- as.numeric(datos.alumnos.df$edad.ingreso)
datos.alumnos.df$BECA <- as.numeric(datos.alumnos.df$BECA)
datos.alumnos.df$evalucion.socioeconomica <- as.numeric(datos.alumnos.df$evalucion.socioeconomica)
str(datos.alumnos.df)

#ds.test <- data.frame()
#ds.test <- cbind(datos.alumnos.df$genero, datos.alumnos.df$CM1)
#str(ds.test)
```

```{r}
sum(datos.alumnos.df$AM11)
colnames(datos.alumnos.df)
#AM1 out
```



```{r}
#ds <- datos.alumnos.df
#ds.test <- data.frame()
#ds.test <- cbind(ds$genero, ds$admision.letras, ds$admision.numeros, ds$promedio.preparatoria, ds$edad.ingreso, ds$evalucion.socioeconomica, ds$nota.conducta, ds$BECA, ds$AM1 )
ds.data.analisis <- datos.alumnos.df
ds.data.analisis$AM1 <- NULL


dataframe.to.cor <- ds.data.analisis

library(corrplot)
source("http://www.sthda.com/upload/rquery_cormat.r")
rquery.cormat(dataframe.to.cor)

col<- colorRampPalette(c("blue", "white", "red"))(20)
# create device
?jpeg
jpeg('correlacion-alumnos-ad.jpg', width=1920, height=1080)
rquery.cormat(dataframe.to.cor, type="full", col=col)
dev.off()
cormat<-rquery.cormat(dataframe.to.cor, type="full", col=col)


```


```{r}
plot.relaciones <- function(x="", y=""){
  alumnos.training$cluster <- clustering.kmeans$cluster
#plot(alumnos.training)
plot(alumnos.training[,c(x, y) ], 
     col = clustering.kmeans$cluster)
}
```

```{r}
plot.relaciones("BECA", "evalucion.socioeconomica")
```

```{r}
plot.relaciones("PDM1", "PSEM1")
```

```{r}
plot.relaciones("VBM1", "PSEM1")
```


```{r}
plot(alumnos.training[,c("VBM1", "PSEM1") ], 
     col = 1:3)
```



















